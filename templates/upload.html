<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI Plagiarism Detector</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>
<style>
body {
  font-family: 'Orbitron', sans-serif;
  background-color: #0a0a0a;
  color: #00ffcc;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;
}
.container {
  width: 100%;
  max-width: 1000px;
  background: #111;
  border: 2px solid #00ffcc;
  border-radius: 15px;
  padding: 30px;
  box-shadow: 0 0 30px rgba(0, 255, 204, 0.3);
  animation: glow 2s infinite alternate;
  margin-top: 40px;
}
@keyframes glow {
  from { box-shadow: 0 0 15px #00ffcc; }
  to { box-shadow: 0 0 30px #ff00ff; }
}
h1 {
  text-align: center;
  margin-bottom: 25px;
  font-size: 2.5rem;
  color: #ff00ff;
  text-shadow: 0 0 15px #ff00ff, 0 0 30px #00ffcc;
}
.input-row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}
textarea, .upload-box {
  flex: 1;
  height: 250px;
  background: #0f0f0f;
  border: 2px solid #00ffcc;
  border-radius: 10px;
  padding: 15px;
  font-size: 1rem;
  color: #00ffcc;
  resize: none;
  outline: none;
  font-family: 'Courier New', monospace;
  box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.3);
  transition: 0.3s;
}
textarea:focus {
  border-color: #ff00ff;
  box-shadow: 0 0 15px #ff00ff, inset 0 0 20px rgba(255,0,255,0.4);
}
.upload-box {
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  cursor: pointer;
  font-size: 1.1rem;
  color: #ff00ff;
  border: 2px dashed #ff00ff;
}
.upload-box:hover {
  background: rgba(255,0,255,0.1);
  box-shadow: 0 0 15px #ff00ff;
}
input[type="file"] { display: none; }
.file-name { text-align:center; margin-top:8px; font-size:1rem; color:#00ffcc; }
button {
  display:block; margin:20px auto; padding:12px 25px; font-size:1.2rem;
  background: linear-gradient(90deg, #00ffcc, #ff00ff); border:none;
  border-radius:30px; cursor:pointer; color:#0a0a0a; font-weight:bold;
  transition: all 0.3s ease; box-shadow: 0 0 20px rgba(0,255,204,0.6);
}
button:hover { transform: scale(1.1); box-shadow: 0 0 25px #ff00ff, 0 0 40px #00ffcc; }
.progress-container {
  margin:25px 0; background:#0f0f0f; border-radius:15px; border:2px solid #00ffcc;
  height:35px; overflow:hidden; position:relative; box-shadow: inset 0 0 15px rgba(0,255,204,0.3);
  display:none;
}
.progress-bar { height:100%; width:0%; background:#00ffcc; transition: width 2s ease-in-out, background 0.5s; }
.progress-label { text-align:center; margin-top:10px; font-size:1.2rem; color:#ff00ff; text-shadow:0 0 10px #ff00ff; display:none; }
.chunk { border-radius:8px; padding:15px; margin-bottom:10px; white-space:pre-wrap; background:#0f0f1a; border-left:6px solid; font-family:'Courier New', monospace; }
.ai { border-color:#ff00ff; background:#1a001a; color:#ff00ff; }
.human { border-color:#00ffcc; background:#00221a; color:#00ffcc; }
h2 { color:#00ffcc; text-shadow:0 0 10px #00ffcc; margin-bottom:18px; }
</style>
</head>
<body>
<div class="container">
<h1>âš¡ AI Plagiarism Detector âš¡</h1>
<form enctype="multipart/form-data" method="post">
  <div class="input-row">
    <textarea name="input_text" id="inputText" placeholder="Paste your text here..."></textarea>
    <label class="upload-box" for="fileInput">ðŸ“‚ Click or Drop File (PDF / DOCX)</label>
    <input accept=".pdf,.docx" id="fileInput" name="file" type="file"/>
  </div>
  <div id="fileName" class="file-name">{{ filename if filename else '' }}</div>
  <button type="submit" class="btn btn-upload">Upload or Check</button>
</form>

<div class="progress-container" id="progressContainer">
  <div class="progress-bar" id="progressBar"></div>
</div>
<div class="progress-label" id="progressLabel"></div>

{% if file_chunks %}
<h2>File Analysis Results:</h2>
{% for (num, para), detect in zipped_file_data %}
<div class="chunk {% if detect.prediction == 'AI-generated' %}ai{% else %}human{% endif %}">
  <strong>
    {% if filetype == 'docx' %}
      Paragraph {{ num }}:
    {% else %}
      Page {{ num }}:
    {% endif %}
  </strong> {{ para }}<br>
  <strong>Prediction:</strong> {{ detect.prediction }}<br>
  <!-- <strong>Probability (AI):</strong> {{ (detect.probability_AI) }} -->
</div>
{% endfor %}
{% endif %}

{% if text_detections %}
<h2>Text Analysis Results:</h2>
{% for detect in text_detections %}
<div class="chunk {% if detect.prediction == 'AI-generated' %}ai{% else %}human{% endif %}">
  <strong>Paragraph:</strong> {{ detect.paragraph }}<br>
  <strong>Prediction:</strong> {{ detect.prediction }}<br>
  <!-- <strong>Probability (AI):</strong> {{ (detect.probability_AI) }} -->
</div>
{% endfor %}
{% endif %}
</div>

<script>
const fileInput = document.getElementById("fileInput");
const textArea = document.getElementById("inputText");
const fileNameDisplay = document.getElementById("fileName");
const progressContainer = document.getElementById("progressContainer");
const progressBar = document.getElementById("progressBar");
const progressLabel = document.getElementById("progressLabel");

window.onload = () => {
  if (fileInput) fileInput.value = "";
  if (textArea) textArea.value = "";
  if (fileNameDisplay && fileNameDisplay.textContent === "") fileNameDisplay.textContent = "";
  if (progressContainer) progressContainer.style.display = "none";
  if (progressLabel) progressLabel.style.display = "none";

  {% if overall_score %}
    const score = {{ overall_score }};
    if(progressContainer && progressBar && progressLabel){
      progressContainer.style.display = "block";
      progressLabel.style.display = "block";
      let current = 0;
      const step = score / 100;
      const interval = setInterval(() => {
        current += step;
        if(current >= score){
          current = score;
          clearInterval(interval);
        }
        progressBar.style.width = current + "%";
        if(score == 0) progressBar.style.background = "#00ff00";
        else if(current < 15) progressBar.style.background = "#00ff00";
        else if(current < 30) progressBar.style.background = "#ffff00";
        else progressBar.style.background = "#ff0000";
        progressLabel.textContent = "Overall AI Probability: " + current.toFixed(2) + "%";
      }, 20);
    }
  {% endif %}
};

// File input display
if(fileInput){
  fileInput.addEventListener("change", function(){
    const file = this.files[0];
    if(!file) return;
    textArea.value = "";
    fileNameDisplay.textContent = "ðŸ“‚ Uploaded File: " + file.name;
  });
}

// Clear file if typing text
if(textArea){
  textArea.addEventListener("input", function(){
    if(fileInput) fileInput.value = "";
    if(fileNameDisplay) fileNameDisplay.textContent = "";
  });
}
</script>
</body>
</html>
